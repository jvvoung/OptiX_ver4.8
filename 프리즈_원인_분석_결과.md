# OptiX í”„ë¡œì íŠ¸ í”„ë¦¬ì¦ˆ ì›ì¸ 12ê°€ì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸

## âœ… í•´ê²°ë¨ | âš ï¸ ë¶€ë¶„ í•´ê²° | âŒ ë¯¸í•´ê²°

---

## 1. UI ìŠ¤ë ˆë“œì—ì„œ ë¬´ê±°ìš´ ì—°ì‚°/ë£¨í”„ âœ… **í•´ê²°ë¨**

### í˜„í™©
- **OpticSeqExecutor.cs**: `Task.Run(() => StartTestAsync())` (102ë²ˆ ì¤„) - ëª¨ë“  í…ŒìŠ¤íŠ¸ ë¡œì§ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰
- **IPVSSeqExecutor.cs**: `Task.Run(() => StartTestAsync())` (84ë²ˆ ì¤„) - ë™ì¼í•˜ê²Œ ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
- **SeqExecutionManager.cs**: DLL í˜¸ì¶œì´ ì´ë¯¸ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ ì¤‘ (Task.Run ì œê±°ë¨, 222-267ë²ˆ ì¤„)

### ì¦ê±°
```csharp
// OpticSeqExecutor.cs:102
isTestStarted = true;
Task.Run(() => StartTestAsync());  // âœ… UI ìŠ¤ë ˆë“œ ë¸”ë¡ ì—†ìŒ
```

### ê²°ë¡ 
âœ… **ì™„ë²½í•˜ê²Œ í•´ê²°ë¨** - ëª¨ë“  ë¬´ê±°ìš´ ì—°ì‚°ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰

---

## 2. Thread.Sleep / Task.Wait / .Result ê°™ì€ ë™ê¸° ëŒ€ê¸° âœ… **í•´ê²°ë¨**

### í˜„í™©
- **DELAY ì²˜ë¦¬**: `await Task.Delay(delayMs)` ì‚¬ìš© (OpticSeqExecutor.cs:385, IPVSSeqExecutor.cs:252)
- **Zone ì™„ë£Œ ëŒ€ê¸°**: `await Task.WhenAll(tasks)` ì‚¬ìš© (OpticSeqExecutor.cs:158)
- **ë¡œê·¸ ìƒì„±**: `_ = Task.Run(...)` fire-and-forget ë°©ì‹ (OpticSeqExecutor.cs:230)

### ì¦ê±°
```csharp
// OpticSeqExecutor.cs:385
await Task.Delay(delayMs);  // âœ… ë¹„ë™ê¸° ì§€ì—°

// OpticSeqExecutor.cs:158
await Task.WhenAll(tasks);  // âœ… ë¹„ë™ê¸° ëŒ€ê¸°
```

### ì˜ˆì™¸ ì‚¬í•­
- **MainWindow.cs:404-408**: `StopServerAsync().Wait(3000)` - ì•± ì¢…ë£Œ ì‹œì—ë§Œ ì‚¬ìš© (í—ˆìš© ê°€ëŠ¥)
- **CommunicationServer.cs:408**: `StopServerAsync().Wait(5000)` - Dispose ì‹œì—ë§Œ ì‚¬ìš© (í—ˆìš© ê°€ëŠ¥)

### ê²°ë¡ 
âœ… **í•´ê²°ë¨** - ì‹¤í–‰ ì¤‘ì—ëŠ” ë™ê¸° ëŒ€ê¸° ì—†ìŒ, ì¢…ë£Œ ì‹œì—ë§Œ ì œí•œì  ì‚¬ìš©

---

## 3. async/await êµì°©(Deadlock) âœ… **í•´ê²°ë¨**

### í˜„í™©
- **UI ìŠ¤ë ˆë“œì—ì„œ .Wait() ì‚¬ìš© ì—†ìŒ**: ëª¨ë“  ë¹„ë™ê¸° ë©”ì„œë“œê°€ `await` ì²´ì¸ ìœ ì§€
- **ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…**: `Task.Run(() => ...)` ì‚¬ìš©ìœ¼ë¡œ UI ì»¨í…ìŠ¤íŠ¸ ë¶„ë¦¬

### ì¦ê±°
```csharp
// OpticSeqExecutor.cs:108
private async Task StartTestAsync()  // âœ… async ì²´ì¸ ìœ ì§€
{
    // ...
    await Task.WhenAll(tasks);  // âœ… .Wait() ì‚¬ìš© ì•ˆ í•¨
}
```

### ê²°ë¡ 
âœ… **í•´ê²°ë¨** - Deadlock íŒ¨í„´ ì—†ìŒ

---

## 4. Dispatcher.Invoke(ë™ê¸° í˜¸ì¶œ) ë‚¨ìš© âš ï¸ **ë¶€ë¶„ í•´ê²° (ê°œì„  ê°€ëŠ¥)**

### í˜„í™©
- **ëŒ€ë¶€ë¶„ InvokeAsync ì‚¬ìš©**: `Dispatcher.InvokeAsync(...)` (ë¹„ë™ê¸°)
- **ì¼ë¶€ Invoke ì‚¬ìš©**: `Dispatcher.Invoke(...)` (ë™ê¸°) - MainWindow.cs:103

### ë¬¸ì œì 
```csharp
// MainWindow.cs:103
Dispatcher.Invoke(() =>  // âš ï¸ ë™ê¸° í˜¸ì¶œ
{
    UpdateAutoModeDisplay(isConnected);
    CommunicationServerStatusChanged?.Invoke(this, isConnected);
    // ...
});
```

### ê°œì„  ë°©ì•ˆ
```csharp
// ê¶Œì¥: InvokeAsync ì‚¬ìš©
_ = Dispatcher.InvokeAsync(() =>
{
    UpdateAutoModeDisplay(isConnected);
    CommunicationServerStatusChanged?.Invoke(this, isConnected);
}, DispatcherPriority.Background);
```

### ê²°ë¡ 
âš ï¸ **ë¶€ë¶„ í•´ê²°** - ëŒ€ë¶€ë¶„ InvokeAsync ì‚¬ìš© ì¤‘ì´ë‚˜, ì¼ë¶€ Invoke ë‚¨ì•„ìˆìŒ

---

## 5. ë½(lock) ê²½í•©/êµì°© âœ… **í•´ê²°ë¨**

### í˜„í™©
- **ErrorLogger.cs**: `BlockingCollection` + ë¹„ë™ê¸° í ë°©ì‹ ì‚¬ìš© (lock ì—†ìŒ, 21ë²ˆ ì¤„)
- **MonitorLogService.cs**: `BlockingCollection` + ë¹„ë™ê¸° í ë°©ì‹ ì‚¬ìš© (lock ì—†ìŒ, 25ë²ˆ ì¤„)
- **CommunicationServer.cs**: `lock (clientsLock)` ì‚¬ìš©í•˜ë‚˜ ë§¤ìš° ì§§ì€ ì„ê³„êµ¬ì—­ (37-41ë²ˆ ì¤„)
- **SeqExecutionManager.cs**: `ConcurrentDictionary` ì‚¬ìš© (lock-free, 77ë²ˆ ì¤„)

### ì¦ê±°
```csharp
// ErrorLogger.cs:21
private static readonly BlockingCollection<LogEntry> _logQueue = 
    new BlockingCollection<LogEntry>(1000);  // âœ… Lock-free í

// SeqExecutionManager.cs:77
private static ConcurrentDictionary<int, ZoneContext> _zoneContexts = 
    new ConcurrentDictionary<int, ZoneContext>();  // âœ… Lock-free
```

### ê²°ë¡ 
âœ… **í•´ê²°ë¨** - Lock ìµœì†Œí™”, ë¹„ë™ê¸° í ë°©ì‹ ì‚¬ìš©

---

## 6. ë™ê¸° I/Oë¥¼ UI ìŠ¤ë ˆë“œì—ì„œ ìˆ˜í–‰ âœ… **í•´ê²°ë¨**

### í˜„í™©
- **íŒŒì¼ ì“°ê¸°**: ëª¨ë‘ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬
  - ErrorLogger: `ProcessLogQueueAsync()` (199ë²ˆ ì¤„)
  - MonitorLogService: `ProcessLogQueueAsync()` (76ë²ˆ ì¤„)
  - ResultLogManager: `Task.Run(() => ...)` (230ë²ˆ ì¤„)
- **ë„¤íŠ¸ì›Œí¬**: `AcceptTcpClientAsync()`, `ReadAsync()`, `WriteAsync()` ì‚¬ìš© (CommunicationServer.cs)

### ì¦ê±°
```csharp
// ErrorLogger.cs:314
await Task.Run(() => File.AppendAllText(filePath, kvp.Value.ToString()));  
// âœ… ë¹„ë™ê¸° íŒŒì¼ ì“°ê¸°

// CommunicationServer.cs:218
var tcpClient = await tcpListener.AcceptTcpClientAsync();  
// âœ… ë¹„ë™ê¸° ë„¤íŠ¸ì›Œí¬
```

### ê²°ë¡ 
âœ… **í•´ê²°ë¨** - ëª¨ë“  I/Oê°€ ë¹„ë™ê¸° ì²˜ë¦¬

---

## 7. Layout/Measure/Arrange ê³¼ë¶€í•˜ âœ… **í•´ê²°ë¨**

### í˜„í™©
- **ë°°ì¹˜ ì—…ë°ì´íŠ¸**: `suppressNotification` íŒŒë¼ë¯¸í„°ë¡œ UI ê°±ì‹  ì–µì œ (OpticPageViewModel.cs:309-334)
- **í•œ ë²ˆì— ì—…ë°ì´íŠ¸**: ëª¨ë“  Zone ë°ì´í„°ë¥¼ í•œ ë²ˆì— ì—…ë°ì´íŠ¸ í›„ UI ê°±ì‹  (OpticSeqExecutor.cs:183-193)

### ì¦ê±°
```csharp
// OpticSeqExecutor.cs:193
viewModel.UpdateDataTableWithDllResult(
    storedOutput.Value, 
    zoneNumber, 
    dataTableManager, 
    suppressNotification: !isLastZone  // âœ… ë§ˆì§€ë§‰ Zoneë§Œ UI ê°±ì‹ 
);

// OpticPageViewModel.cs:331-334
if (!suppressNotification)
{
    OnPropertyChanged(nameof(DataItems));  // âœ… ë°°ì¹˜ í›„ í•œ ë²ˆë§Œ ê°±ì‹ 
}
```

### ê²°ë¡ 
âœ… **í•´ê²°ë¨** - ë°°ì¹˜ ì—…ë°ì´íŠ¸ë¡œ Layout ê³¼ë¶€í•˜ ë°©ì§€

---

## 8. ê°€ìƒí™” ë¹„í™œì„± + ëŒ€ëŸ‰ í•­ëª© ë Œë”ë§ âš ï¸ **í™•ì¸ í•„ìš”**

### í˜„í™©
- **XAML íŒŒì¼ ë¯¸í™•ì¸**: í˜„ì¬ ì½”ë“œë² ì´ìŠ¤ì—ì„œ XAML íŒŒì¼ ë‚´ìš© í™•ì¸ ë¶ˆê°€
- **DataItems**: `ObservableCollection<DataTableItem>` ì‚¬ìš© (OpticPageViewModel.cs:47)

### í™•ì¸ í•„ìš” ì‚¬í•­
```xml
<!-- OpticPage.xaml í™•ì¸ í•„ìš” -->
<ItemsControl ItemsSource="{Binding DataItems}">
    <ItemsControl.ItemsPanel>
        <ItemsPanelTemplate>
            <!-- VirtualizingStackPanel ì‚¬ìš© ì—¬ë¶€ í™•ì¸ -->
            <VirtualizingStackPanel IsVirtualizing="True" 
                                   VirtualizationMode="Recycling" />
        </ItemsPanelTemplate>
    </ItemsControl.ItemsPanel>
</ItemsControl>
```

### ê²°ë¡ 
âš ï¸ **í™•ì¸ í•„ìš”** - XAML íŒŒì¼ì—ì„œ ê°€ìƒí™” ì„¤ì • í™•ì¸ í•„ìš”

---

## 9. ì´ë¯¸ì§€/Bitmap ì²˜ë¦¬ ë¹„ìš©ì„ UI ìŠ¤ë ˆë“œì—ì„œ ìˆ˜í–‰ âœ… **í•´ë‹¹ ì—†ìŒ**

### í˜„í™©
- **ì´ë¯¸ì§€ ì²˜ë¦¬ ì½”ë“œ ì—†ìŒ**: í”„ë¡œì íŠ¸ ë‚´ì—ì„œ ì´ë¯¸ì§€ ë””ì½”ë”©/ìŠ¤ì¼€ì¼ë§ ì½”ë“œ ë°œê²¬ ì•ˆ ë¨
- **ì •ì  ì´ë¯¸ì§€ë§Œ ì‚¬ìš©**: `Images\` í´ë”ì˜ ì •ì  ë¦¬ì†ŒìŠ¤ë§Œ ì‚¬ìš© (CIE_1976.png, CIExy1931.png, OptixIcon.ico)

### ê²°ë¡ 
âœ… **í•´ë‹¹ ì—†ìŒ** - ë™ì  ì´ë¯¸ì§€ ì²˜ë¦¬ ì—†ìŒ

---

## 10. ë¹„ì‹¼ ValueConverter/Triggers ë‹¤ëŸ‰ í˜¸ì¶œ âš ï¸ **í™•ì¸ í•„ìš”**

### í˜„í™©
- **C# ì½”ë“œì—ì„œ í™•ì¸ ë¶ˆê°€**: ValueConverterëŠ” XAMLì—ì„œ ì •ì˜ë˜ë¯€ë¡œ í™•ì¸ í•„ìš”
- **ë°”ì¸ë”© ìµœì í™”**: `suppressNotification` íŒŒë¼ë¯¸í„°ë¡œ ë¶ˆí•„ìš”í•œ PropertyChanged ì–µì œ

### í™•ì¸ í•„ìš” ì‚¬í•­
```xml
<!-- XAMLì—ì„œ ValueConverter ì‚¬ìš© ì—¬ë¶€ í™•ì¸ -->
<TextBlock Text="{Binding Value, Converter={StaticResource HeavyConverter}}" />
```

### ê²°ë¡ 
âš ï¸ **í™•ì¸ í•„ìš”** - XAML íŒŒì¼ì—ì„œ ValueConverter í™•ì¸ í•„ìš”

---

## 11. ëŒ€ëŸ‰ í• ë‹¹ìœ¼ë¡œ ì¸í•œ GC ì¼ì‹œì •ì§€ âœ… **í•´ê²°ë¨**

### í˜„í™©
- **êµ¬ì¡°ì²´ ì¬ì‚¬ìš©**: `ZoneContext`ì—ì„œ Input/Output ì¬ì‚¬ìš© (SeqExecutionManager.cs:15-62)
- **StringBuilder ì‚¬ìš©**: ë¡œê·¸ ë²„í¼ë§ì— StringBuilder ì‚¬ìš© (ErrorLogger.cs:202, MonitorLogService.cs:79)
- **í í¬ê¸° ì œí•œ**: `BlockingCollection` í¬ê¸° ì œí•œ (ErrorLogger.cs:21, MonitorLogService.cs:25)

### ì¦ê±°
```csharp
// SeqExecutionManager.cs:26-46
public void Reset()  // âœ… êµ¬ì¡°ì²´ ì¬ì‚¬ìš©
{
    SharedInput = new Input { /* ... */ };
    SharedOutput = new Output { /* ... */ };
}

// ErrorLogger.cs:202
var buffers = new Dictionary<string, StringBuilder>();  // âœ… StringBuilder ì‚¬ìš©
```

### ê²°ë¡ 
âœ… **í•´ê²°ë¨** - í• ë‹¹ ìµœì†Œí™”, ì¬ì‚¬ìš© íŒ¨í„´ ì ìš©

---

## 12. ì™¸ë¶€ DLL í˜¸ì¶œì´ ë¸”ë¡œí‚¹ âœ… **í•´ê²°ë¨**

### í˜„í™©
- **DLL í˜¸ì¶œ ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰**: `Task.Run()` ì œê±°í–ˆìœ¼ë‚˜ ì´ë¯¸ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ ì¤‘
- **P/Invoke ìµœì í™”**: êµ¬ì¡°ì²´ ë§ˆìƒ¬ë§ ìµœì†Œí™” (DllFunctions.cs:28-68)

### ì¦ê±°
```csharp
// SeqExecutionManager.cs:222-257
public static async Task<bool> ExecuteMappedAsync(...)
{
    // âœ… ì´ë¯¸ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ ì¤‘ (StartTestAsync â†’ ExecuteSeqForZone)
    // Task.Run() ì œê±° (ì¤‘ë³µ ë°©ì§€)
    switch (functionName)
    {
        case "MTP":
            var (output, ok) = DllFunctions.CallMTPTestFunction(context.SharedInput);
            // ...
    }
}

// DllFunctions.cs:28-68
public static (Output output, bool success) CallMTPTestFunction(Input input)
{
    // âœ… ë§ˆìƒ¬ë§ ìµœì í™”
    IntPtr inputPtr = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(Input)));
    // ...
    Marshal.FreeHGlobal(inputPtr);  // âœ… ë©”ëª¨ë¦¬ í•´ì œ
}
```

### ê²°ë¡ 
âœ… **í•´ê²°ë¨** - DLL í˜¸ì¶œì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰, ë§ˆìƒ¬ë§ ìµœì í™”ë¨

---

## ğŸ“Š ì¢…í•© ê²°ê³¼

| ë²ˆí˜¸ | í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|------|
| 1 | UI ìŠ¤ë ˆë“œ ë¬´ê±°ìš´ ì—°ì‚° | âœ… í•´ê²° | Task.Run ì‚¬ìš© |
| 2 | ë™ê¸° ëŒ€ê¸° | âœ… í•´ê²° | await ì‚¬ìš© |
| 3 | async/await êµì°© | âœ… í•´ê²° | Deadlock íŒ¨í„´ ì—†ìŒ |
| 4 | Dispatcher.Invoke ë‚¨ìš© | âš ï¸ ë¶€ë¶„ í•´ê²° | ì¼ë¶€ Invoke ë‚¨ì•„ìˆìŒ |
| 5 | ë½ ê²½í•©/êµì°© | âœ… í•´ê²° | Lock-free êµ¬ì¡° |
| 6 | ë™ê¸° I/O | âœ… í•´ê²° | ë¹„ë™ê¸° I/O |
| 7 | Layout ê³¼ë¶€í•˜ | âœ… í•´ê²° | ë°°ì¹˜ ì—…ë°ì´íŠ¸ |
| 8 | ê°€ìƒí™” ë¹„í™œì„± | âš ï¸ í™•ì¸ í•„ìš” | XAML í™•ì¸ í•„ìš” |
| 9 | ì´ë¯¸ì§€ ì²˜ë¦¬ | âœ… í•´ë‹¹ ì—†ìŒ | ë™ì  ì´ë¯¸ì§€ ì—†ìŒ |
| 10 | ValueConverter | âš ï¸ í™•ì¸ í•„ìš” | XAML í™•ì¸ í•„ìš” |
| 11 | GC ì¼ì‹œì •ì§€ | âœ… í•´ê²° | í• ë‹¹ ìµœì†Œí™” |
| 12 | DLL ë¸”ë¡œí‚¹ | âœ… í•´ê²° | ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ |

### ì ìˆ˜: **9/12 ì™„ì „ í•´ê²°, 1/12 ë¶€ë¶„ í•´ê²°, 2/12 í™•ì¸ í•„ìš”**

---

## ğŸ”§ ê°œì„  ê¶Œì¥ ì‚¬í•­

### 1. Dispatcher.Invoke â†’ InvokeAsync ë³€ê²½ (MainWindow.cs:103)

**í˜„ì¬ ì½”ë“œ:**
```csharp
// MainWindow.cs:103
Dispatcher.Invoke(() =>
{
    UpdateAutoModeDisplay(isConnected);
    CommunicationServerStatusChanged?.Invoke(this, isConnected);
    // ...
});
```

**ê¶Œì¥ ì½”ë“œ:**
```csharp
_ = Dispatcher.InvokeAsync(() =>
{
    UpdateAutoModeDisplay(isConnected);
    CommunicationServerStatusChanged?.Invoke(this, isConnected);
    // ...
}, DispatcherPriority.Background);
```

### 2. XAML ê°€ìƒí™” í™•ì¸ (OpticPage.xaml, IPVSPage.xaml)

**ê¶Œì¥ ì„¤ì •:**
```xml
<DataGrid ItemsSource="{Binding DataItems}"
          VirtualizingPanel.IsVirtualizing="True"
          VirtualizingPanel.VirtualizationMode="Recycling"
          EnableRowVirtualization="True"
          EnableColumnVirtualization="True">
</DataGrid>
```

### 3. ValueConverter ìµœì í™” í™•ì¸

**í™•ì¸ ì‚¬í•­:**
- ë¬´ê±°ìš´ ê³„ì‚°ì´ ìˆëŠ” ConverterëŠ” ìºì‹± ì ìš©
- Converter ë‚´ë¶€ì—ì„œ íŒŒì¼ I/O, DB ì¿¼ë¦¬ ê¸ˆì§€
- MultiBinding ì‚¬ìš© ì‹œ ë¶ˆí•„ìš”í•œ ë³€í™˜ ì œê±°

---

## âœ¨ ê²°ë¡ 

**OptiX í”„ë¡œì íŠ¸ëŠ” í”„ë¦¬ì¦ˆ ë°©ì§€ë¥¼ ìœ„í•œ ëŒ€ë¶€ë¶„ì˜ Best Practiceë¥¼ ì˜ ë”°ë¥´ê³  ìˆìŠµë‹ˆë‹¤!**

- âœ… **9ê°œ í•­ëª© ì™„ì „ í•´ê²°** (75%)
- âš ï¸ **1ê°œ í•­ëª© ë¶€ë¶„ í•´ê²°** (8%)
- âš ï¸ **2ê°œ í•­ëª© í™•ì¸ í•„ìš”** (17%)

**íŠ¹íˆ ì˜ëœ ì :**
1. ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë° íŒ¨í„´ (async/await) ì² ì €íˆ ì ìš©
2. Lock-free êµ¬ì¡° (ConcurrentDictionary, BlockingCollection)
3. ë°°ì¹˜ ì—…ë°ì´íŠ¸ë¡œ UI ê°±ì‹  ìµœì†Œí™”
4. ë°±ê·¸ë¼ìš´ë“œ ë¡œê·¸ í ë°©ì‹ìœ¼ë¡œ I/O ë¸”ë¡ ì œê±°

**ê°œì„  ì—¬ì§€:**
1. ì¼ë¶€ Dispatcher.Invoke â†’ InvokeAsync ë³€ê²½
2. XAML ê°€ìƒí™” ì„¤ì • í™•ì¸
3. ValueConverter ìµœì í™” í™•ì¸

